
*Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:* {len(new_prompt)} Ø­Ø±Ù"""
                
                bot.edit_message_text(
                    history_details,
                    call.message.chat.id,
                    call.message.message_id,
                    parse_mode='Markdown',
                    reply_markup=InlineKeyboardMarkup().add(
                        InlineKeyboardButton("ğŸ”™ Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„", callback_data="boss_request_history")
                    )
                )
            else:
                bot.answer_callback_query(call.id, "âŒ Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„", show_alert=True)
                
        elif call.data == "boss_request_stats":
            approved_count = sum(1 for req in processed_changes if req.get("status") == "approved")
            rejected_count = sum(1 for req in processed_changes if req.get("status") == "rejected")
            pending_count = len(pending_changes)
            total_count = len(processed_changes) + pending_count
            
            # Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²Ù…Ù†ÙŠØ©
            today = datetime.now().strftime("%Y-%m-%d")
            today_requests = sum(1 for req in processed_changes if req.get("processed_at", "").startswith(today))
            
            # Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹
            channel_stats = {}
            for req in processed_changes:
                channel_name = req.get("channel_name", "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ")
                if channel_name in channel_stats:
                    channel_stats[channel_name] += 1
                else:
                    channel_stats[channel_name] = 1
            
            top_channels = sorted(channel_stats.items(), key=lambda x: x[1], reverse=True)[:5]
            
            stats_text = f"""ğŸ“ˆ *Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©*

*Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©:*
â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: {total_count}
â€¢ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©: {pending_count}
â€¢ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: {len(processed_changes)}
â€¢ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§: {approved_count}
â€¢ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©: {rejected_count}

*Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ… ({today}):*
â€¢ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙŠÙˆÙ…: {today_requests}

*Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹:*
"""
            
            for channel, count in top_channels:
                stats_text += f"â€¢ {channel}: {count} Ø·Ù„Ø¨\n"
            
            if not top_channels:
                stats_text += "â€¢ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ©\n"
            
            # Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
            if len(processed_changes) > 0:
                success_rate = (approved_count / len(processed_changes)) * 100
                stats_text += f"\n*Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­:* {success_rate:.1f}%"
            
            bot.edit_message_text(
                stats_text,
                call.message.chat.id,
                call.message.message_id,
                parse_mode='Markdown',
                reply_markup=InlineKeyboardMarkup().add(
                    InlineKeyboardButton("ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª", callback_data="boss_request_stats"),
                    InlineKeyboardButton("ğŸ”™ Ø±Ø¬ÙˆØ¹", callback_data="back_to_boss")
                )
            )
                
        elif call.data.startswith("view_"):
            request_id = call.data.replace("view_", "")
            
            if request_id in pending_changes:
                request_data = pending_changes[request_id]
                new_prompt = request_data.get("new_prompt", "")
                
                # Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
                bot.send_message(
                    call.message.chat.id,
                    f"ğŸ“„ *Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø·Ù„Ø¨ {request_id}:*\n\n```\n{new_prompt}\n```",
                    parse_mode='Markdown'
                )
                bot.answer_callback_query(call.id, "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©")
                
        elif call.data.startswith("approve_"):
            parts = call.data.split("_")
            if len(parts) == 4:
                request_id = parts[1]
                user_id = int(parts[2])
                channel_id = parts[3]
                
                if request_id in pending_changes:
                    change_data = pending_changes[request_id]
                    
                    # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    if channel_id in channels:
                        channels[channel_id]["custom_prompt"] = change_data["new_prompt"]
                        channels[channel_id]["personality_updated"] = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                        save_channels()
                        
                        # Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„
                        processed_request = {
                            "request_id": request_id,
                            "user_id": user_id,
                            "channel_id": channel_id,
                            "channel_name": change_data["channel_name"],
                            "new_prompt": change_data["new_prompt"],
                            "timestamp": change_data["timestamp"],
                            "status": "approved",
                            "processed_by": call.from_user.id,
                            "processed_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                        }
                        processed_changes.append(processed_request)
                        save_processed_changes()
                        
                        # Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                        channel_name = channels[channel_id]['username']
                        bot.send_message(
                            user_id,
                            f"âœ… *ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø®ØµÙŠØ©*\n\n"
                            f"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø´Ø®ØµÙŠØ© Ø§Ù„Ù‚Ù†Ø§Ø© {channel_name} Ø¨Ù†Ø¬Ø§Ø­.\n"
                            f"Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù‚Ø§Ø¯Ù….\n"
                            f"*Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:* {request_id}",
                            parse_mode='Markdown'
                        )
                        
                        # Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù‚
                        del pending_changes[request_id]
                        save_pending_changes()
                        
                        bot.answer_callback_query(call.id, "âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØºÙŠÙŠØ±")
                        
                        # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                        bot.edit_message_text(
                            f"âœ… *ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨*\n\n"
                            f"*Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:* {request_id}\n"
                            f"*Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:* {user_id}\n"
                            f"*Ø§Ù„Ù‚Ù†Ø§Ø©:* {channel_name}\n"
                            f"*Ø§Ù„ÙˆÙ‚Øª:* {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n"
                            f"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø´Ø®ØµÙŠØ© Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­.",
                            call.message.chat.id,
                            call.message.message_id,
                            parse_mode='Markdown',
                            reply_markup=InlineKeyboardMarkup().add(
                                InlineKeyboardButton("ğŸ“‹ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø·Ù„Ø¨Ø§Øª", callback_data="boss_pending_requests")
                            )
                        )
                    else:
                        bot.answer_callback_query(call.id, "âŒ Ø§Ù„Ù‚Ù†Ø§Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©", show_alert=True)
                else:
                    bot.answer_callback_query(call.id, "âŒ Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", show_alert=True)
                    
        elif call.data.startswith("reject_"):
            parts = call.data.split("_")
            if len(parts) == 4:
                request_id = parts[1]
                user_id = int(parts[2])
                channel_id = parts[3]
                
                if request_id in pending_changes:
                    change_data = pending_changes[request_id]
                    channel_name = change_data["channel_name"]
                    
                    # Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„
                    processed_request = {
                        "request_id": request_id,
                        "user_id": user_id,
                        "channel_id": channel_id,
                        "channel_name": channel_name,
                        "new_prompt": change_data["new_prompt"],
                        "timestamp": change_data["timestamp"],
                        "status": "rejected",
                        "processed_by": call.from_user.id,
                        "processed_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                    }
                    processed_changes.append(processed_request)
                    save_processed_changes()
                    
                    # Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø±ÙØ¶ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    bot.send_message(
                        user_id,
                        f"âŒ *ØªÙ… Ø±ÙØ¶ ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø®ØµÙŠØ©*\n\n"
                        f"ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ ØªØºÙŠÙŠØ± Ø´Ø®ØµÙŠØ© Ø§Ù„Ù‚Ù†Ø§Ø© {channel_name}.\n"
                        f"*Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:* {request_id}\n"
                        f"*Ø§Ù„Ø³Ø¨Ø¨:* ØªÙ… Ø§Ù„Ø±ÙØ¶ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¯ÙŠØ±\n\n"
                        f"ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„Ù‡.",
                        parse_mode='Markdown'
                    )
                    
                    # Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù‚
                    del pending_changes[request_id]
                    save_pending_changes()
                    
                    bot.answer_callback_query(call.id, "âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØºÙŠÙŠØ±")
                    
                    # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                    bot.edit_message_text(
                        f"âŒ *ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨*\n\n"
                        f"*Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:* {request_id}\n"
                        f"*Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:* {user_id}\n"
                        f"*Ø§Ù„Ù‚Ù†Ø§Ø©:* {channel_name}\n"
                        f"*Ø§Ù„ÙˆÙ‚Øª:* {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n"
                        f"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø±ÙØ¶ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù….",
                        call.message.chat.id,
                        call.message.message_id,
                        parse_mode='Markdown',
                        reply_markup=InlineKeyboardMarkup().add(
                            InlineKeyboardButton("ğŸ“‹ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø·Ù„Ø¨Ø§Øª", callback_data="boss_pending_requests")
                        )
                    )
                else:
                    bot.answer_callback_query(call.id, "âŒ Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", show_alert=True)
            
        elif call.data == "back_to_main":
            user_states[call.message.chat.id] = "main_menu"
            bot.edit_message_text(
                "ğŸ  *Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©*\n\nØ§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:",
                call.message.chat.id,
                call.message.message_id,
                parse_mode='Markdown',
                reply_markup=create_main_menu()
            )
            
        elif call.data == "back_to_manage":
            user_states[call.message.chat.id] = "manage_channel"
            bot.edit_message_text(
                "âš™ï¸ *Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª*\n\nØ§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:",
                call.message.chat.id,
                call.message.message_id,
                parse_mode='Markdown',
                reply_markup=create_manage_channel_menu()
            )
            
        elif call.data == "back_to_options":
            user_states[call.message.chat.id] = "more_options"
            bot.edit_message_text(
                "ğŸ”§ *Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª*\n\nØ§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:",
                call.message.chat.id,
                call.message.message_id,
                parse_mode='Markdown',
                reply_markup=create_more_options_menu()
            )
            
        elif call.data == "no_action":
            bot.answer_callback_query(call.id, "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´ÙŠØ¡ Ù„Ù„Ù‚ÙŠØ§Ù… Ø¨Ù‡")
            
    except Exception as e:
        logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© callback: {e}")
        bot.answer_callback_query(call.id, "Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰")

def process_channel_username(message):
    if message.from_user.id != ADMIN_ID:
        return
    
    channel_username = message.text.strip()
    
    if not channel_username.startswith('@'):
        channel_username = '@' + channel_username
    
    try:
        for channel_id, data in channels.items():
            if data['username'].lower() == channel_username.lower():
                user_states[message.chat.id] = "main_menu"
                bot.send_message(message.chat.id, 
                               f"âŒ *Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ù†Ø§Ø© Ù…Ø¶Ø§ÙÙ‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹!*\n\nØ§Ù„Ù‚Ù†Ø§Ø©: {channel_username}\n\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ù†Ø§Ø© Ø£Ø®Ø±Ù‰.",
                               parse_mode='Markdown',
                               reply_markup=create_main_menu())
                return
        
        chat_info = bot.get_chat(channel_username)
        channel_id = str(chat_info.id)
        
        try:
            admins = bot.get_chat_administrators(channel_id)
            bot_is_admin = any(admin.user.id == bot.get_me().id for admin in admins)
            if not bot_is_admin:
                raise Exception("Ø§Ù„Ø¨ÙˆØª Ù„ÙŠØ³ Ù…Ø¯ÙŠØ±Ø§Ù‹ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©")
        except Exception as e:
            user_states[message.chat.id] = "main_menu"
            bot.send_message(message.chat.id,
                           f"âŒ *Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª!*\n\nØªØ£ÙƒØ¯ Ù…Ù†:\n1ï¸âƒ£ Ø£Ù† Ø§Ù„Ø¨ÙˆØª Ù…Ø¯ÙŠØ± ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© {channel_username}\n2ï¸âƒ£ Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù†Ø´Ø±",
                           parse_mode='Markdown',
                           reply_markup=create_main_menu())
            return
        
        channels[channel_id] = {
            "username": channel_username,
            "added_date": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
            "custom_prompt": None
        }
        save_channels()
        
        try:
            poem_data = generate_poem(channel_id)
            if poem_data:
                separator = "\n" + "â•" * 30 + "\n"
                welcome_msg = "ğŸ‰ *Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù‚Ù†Ø§Ø© Ø§Ù„Ø´Ø¹Ø± Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ø³Ø§Ø®Ø±!*\n\n" + poem_data["formatted"] + separator + "ğŸ“š *Ø£ÙˆÙ„Ù‰ Ù‚ØµØ§Ø¦Ø¯Ù†Ø§ Ù…Ù† Ø§Ù„ØªØ±Ø§Ø« Ø§Ù„Ø¹Ø±Ø¨ÙŠ* ğŸ“š"
                
                bot.send_message(channel_id, welcome_msg, parse_mode='Markdown')
                
                if poem_data["title"] and poem_data["title"] not in posted_poems:
                    posted_poems.append(poem_data["title"])
                    save_posted_poems()
                    
        except Exception as e:
            bot.send_message(message.chat.id, 
                           f"âš ï¸ *ØªÙ†Ø¨ÙŠÙ‡*\n\nØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ù†Ø§Ø© {channel_username} ÙˆÙ„ÙƒÙ† Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø£ÙˆÙ„.\n\nØ§Ù„ØªÙØ§ØµÙŠÙ„: {str(e)[:100]}",
                           parse_mode='Markdown')
            user_states[message.chat.id] = "main_menu"
            bot.send_message(message.chat.id,
                           "âœ… *ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ù†Ø§Ø©*",
                           parse_mode='Markdown',
                           reply_markup=create_main_menu())
            return
        
        user_states[message.chat.id] = "main_menu"
        bot.send_message(message.chat.id, 
                       f"âœ… *ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!*\n\nØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ù†Ø§Ø©: {channel_username}\nÙˆØ¨Ø¯Ø£ Ø§Ù„Ù†Ø´Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.\n\nğŸ“š *Ù…Ù„Ø§Ø­Ø¸Ø©:* Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ØµØ§Ø¦Ø¯ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ø£Ø¯Ø¨ÙŠØ© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ø°ÙƒÙˆØ±Ø©.",
                       parse_mode='Markdown',
                       reply_markup=create_main_menu())
        
    except Exception as e:
        user_states[message.chat.id] = "main_menu"
        error_msg = f"""âŒ *Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©!*

Ø§Ù„ØªÙØ§ØµÙŠÙ„: {str(e)[:150]}

*ØªØ£ÙƒØ¯ Ù…Ù†:*
1ï¸âƒ£ Ø£Ù† Ø§Ù„Ø¨ÙˆØª Ù…Ø¯ÙŠØ± ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©
2ï¸âƒ£ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© ØµØ­ÙŠØ­ ÙˆÙŠØ¨Ø¯Ø£ Ø¨Ù€ @
3ï¸âƒ£ Ø§Ù„Ù‚Ù†Ø§Ø© Ø¹Ø§Ù…Ø©
4ï¸âƒ£ Ø§Ù„Ø¨ÙˆØª Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù†Ø´Ø±"""
        
        bot.send_message(message.chat.id, error_msg, 
                        parse_mode='Markdown',
                        reply_markup=create_main_menu())

def process_personality_change(message, channel_id):
    if message.from_user.id != ADMIN_ID:
        return
    
    new_prompt = message.text.strip()
    
    if channel_id not in channels:
        bot.send_message(message.chat.id, "âŒ Ø§Ù„Ù‚Ù†Ø§Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!", parse_mode='Markdown')
        return
    
    if len(new_prompt) < 50:
        bot.send_message(message.chat.id, "âŒ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹! ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 50 Ø­Ø±ÙØ§Ù‹.", parse_mode='Markdown')
        return
    
    channel_name = channels[channel_id]['username']
    user_id = message.from_user.id
    
    request_id = str(uuid.uuid4())[:8]
    
    pending_changes[request_id] = {
        "user_id": user_id,
        "channel_id": channel_id,
        "channel_name": channel_name,
        "new_prompt": new_prompt,
        "timestamp": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    }
    save_pending_changes()
    
    approval_message = f"""ğŸ”” *Ø·Ù„Ø¨ ØªØºÙŠÙŠØ± Ø´Ø®ØµÙŠØ© Ù‚Ù†Ø§Ø©*

*Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:* {user_id}
*Ø§Ù„Ù‚Ù†Ø§Ø©:* {channel_name}
*Ø§Ù„ÙˆÙ‚Øª:* {datetime.now().strftime("%Y-%m-%d %H:%M:%S")}

*Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯:*